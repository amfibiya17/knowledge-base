# 2.4 useLayoutEffect

This file introduces the `useLayoutEffect` hook.
`useLayoutEffect` is similar to `useEffect`, but it runs **earlier in the rendering process**.

---

## What `useLayoutEffect` is

`useLayoutEffect` is a React hook that allows a component to:

- run side effects **synchronously after DOM updates**
- read layout information from the DOM
- make DOM changes **before the browser paints**

It is mainly used for **layout-related effects**.

---

## Key difference from `useEffect`

The main difference is **when** the effect runs.

- `useEffect` runs **after the browser paints**
- `useLayoutEffect` runs **before the browser paints**

This timing difference matters for visual layout work.

---

## Basic syntax

```jsx
useLayoutEffect(() => {
  // layout-related side effect
}, [dependencies]);
```

The API is the same as `useEffect`.

Only the timing is different.

---

## When `useLayoutEffect` runs

The sequence is:

- component renders
- React updates the DOM
- `useLayoutEffect` runs **synchronously**
- browser paints the screen

Because it runs before paint, the user never sees intermediate states.

---

## Example: measuring layout

```jsx
const ref = useRef(null);

useLayoutEffect(() => {
  const height = ref.current.getBoundingClientRect().height;
  setHeight(height);
}, []);
```

Here:

- the DOM is already updated
- layout measurements are accurate
- updates happen before the browser paints

This prevents visual flicker.

---

## Why not use `useEffect` here?

If you use `useEffect` for layout measurements:

- the browser may paint first
- then the effect runs
- then state updates cause another paint

This can cause visible flicker or jumps.

`useLayoutEffect` avoids this by running earlier.

---

## `useLayoutEffect` and blocking

Important difference:

- `useLayoutEffect` **blocks painting**
- `useEffect` does **not**

Because of this:

- `useLayoutEffect` should be used sparingly
- heavy work inside it can hurt performance

---

## When to use `useLayoutEffect`

Use it when you need to:

- measure DOM size or position
- synchronously update layout-related state
- prevent visual flicker
- interact with DOM APIs that affect layout

---

## When NOT to use `useLayoutEffect`

Do **not** use it for:

- data fetching
- subscriptions
- timers
- logging
- non-visual side effects

These belong in `useEffect`.

---

## What `useLayoutEffect` does NOT do

- It does not replace `useEffect`
- It does not improve performance by default
- It does not eliminate re-renders
- It does not fix layout problems automatically

---

## Common mistakes

- Using `useLayoutEffect` everywhere
- Putting heavy logic inside it
- Using it when `useEffect` is sufficient
- Forgetting that it blocks painting

> If you are not reading or writing layout, you probably do not need `useLayoutEffect`.

---

## Mental model

- Render → React updates DOM
- `useLayoutEffect` → adjust layout before paint
- Browser paint → user sees final UI
- `useEffect` → sync with external systems after paint

---

## Summary

- `useLayoutEffect` runs synchronously after DOM updates
- It runs before the browser paints
- It is useful for layout measurements and adjustments
- It blocks painting, so use it carefully
- Prefer `useEffect` unless layout timing matters
